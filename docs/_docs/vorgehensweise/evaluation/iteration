---
title: Änderungen am Skillsystem
permalink: /docs/evaluation/iteration
---

Es wurden einige Änderungen am Skillsystem von Finn Wehn vorgenommen. 

## Sprachunabhängigkeit

Wie in der Evaluation angemerkt war die Sprachunabhängigkeit schon gegeben. Um mehrere verschiedene Antworten von einem Skill zu ermöglichen, wurde die einzelne Antwort durch eine Liste an Antworten ersetzt. Wenn nun eine Antwort generiert werden soll, muss ein Index mit angegeben werden. Die Funktion zur Generation wurde um diesen Parameter erweitert. <br>

Außerdem ist eine Funktion zur Generation von Aufzählungen aus Listen hinzugefügt worden.

## Dynamische Slots

Dynamische Sloteinträge können sowohl beim Aktivieren von Skills Konfigurationsdateien ausgelesen und an Rhasspy gepostet werden, als auch durch einen Bot hinzugefügt werden. Um dies umzusetzen, musste zunächst das Konfigurationsobjekt der `CustomSDK` um Liste mit den dynamischen Slots der einzelnen Skills erweitert werden. Die Namen der Slots werden aus den Manifestdatei jedes Skills ausgelesen und das Konfigurationsobjekt beim Laden der Skills damit gefüllt. Die Werte, die die Slots annehmen können, werden aus Rhasspy ausgelesen und anhand der vorher ermittelten Namen in die Liste einsortiert. Außerdem erhält das Konfigurationsobjekt eine Funktion zum Posten der Slots. Wenn nun ein neuer Slot Eintrag hinzugefügt werden soll, wird dieser zunächst an Rhasspy gepostet, danach wird Rhasspy neu trainiert und die Werte im Konfigurationsobjekt  aktualisiert. <br>

In den `locales` Dateien jedes Skills müssen die Slots trotzdem eingetragen werden. Da die Werte sofort überschrieben werden, kann da als Platzhalter ein Unterstrich eingegeben werden. Wenn dieser Eintrag vergessen wird, lässt sich Rhasspy nicht trainieren. <br>

Aus dem Slot `zigbeeDevices` wurden die Gruppen entfernt. Diese werden nun in einem seperaten Slot namens `zigbee_groups` gespeichert. Wie der ursprüngliche Slot erhalten diese auch einen Eintrag im Konfigurationsobjekt der `CustomSDK`. Durch diese Änderungen können nun Gruppen im Skill Zigbee2MQTT verwaltet werden.

## Fehlerbehandlung

Um ausschlagkräftigere Fehlermeldungen zu ermöglichen und dennoch sprachunabhängigen Code beizubehalten wurde jeder Sprachbefehl um eine Liste an Fehlermeldungen erweitert. Diese orientieren sich am Vorbild der Antworten. Deswegen wurde in der CustomSDK noch eine Funktion zur Generation von Fehlermeldungen eingerichtet. Tritt nun ein Fehler auf kann er von der Fehlerbehandlung der CustomSDK aufgefangen werden und eine Fehlernachricht generiert und von Rhasspy gesagt werden. Es wird weiterhin der eigentliche Fehler in der Konsole ausgegeben.

## NodeJS Module

Bei der Installation eines Skills wird nun die `Manifest` Datei eingelesen, die Module daraus extrahiert und dann installiert. Erst danach wird die Installation des Skills fortgesetzt. Dazu wurde eine neue Funktion des Skillmanagers erstellt und von der Weboberfläche und dem Terminalschnittstelle verwendet. 

## Umgebungsvariablen

Um die Umgebungsvariablen für das Programm zugänglich zu machen wurden die Skripte zum Starten des Clients und des Servers um die Initialisierung des "dotenv" Moduls erweitert. Dieses lädt die Variablen in die Prozessumgebung und macht sie für Programme zugänglich.

## Detailseite

Mithilfe der Eigenschaft `custom_slots` des Konfigurationsobjektes, welche die dynamischen Slots nach Skill geordnet enthält, können diese jedem Skill eindeutig zugeordnet werden. Wird nun die Detailseite aufgerufen, werden die Slots dort ausgelesen. Gibt es für einen Slot mehr als fünf Einträge wird eine zufällige Menge daraus angezeigt. Die weiteren Einträge der Detailsseite sind beibehalten worden.



Damit die dynamischen Slots korrekt den Skills zugeordnet werden können, sind die Manifest Dateien um eine Liste der zum Skill zugehörigen dynamischen Slots erweitert worden. Diese wird im Konfigurationsobjekt gespeichert und mit den möglichen Einträgen befüllt. Wird ein neuer Eintrag zu einem Slot hinzugefügt, wird auch das Konfigurationsobjekt aktualisiert.